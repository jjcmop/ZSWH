OpenInstall=function(e,n,t){function r(){this.arr=[],this.run=function(e){this.arr?this.arr[this.arr.length]=e:e()},this.isReady=function(){return null==this.arr},this.ready=function(){if(null!=this.arr)for(var e=0;e<this.arr.length;e++)this.arr[e]();this.arr=null}}function i(e){var n=[];for(var t in e){var r=e[t];if("[object Array]"==Object.prototype.toString.call(r))for(var i=0;i<r.length;i++)null!=r[i]&&"undefined"!=typeof r[i]&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r[i]));else null!=r&&"undefined"!=typeof r&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}return n.join("&")}function a(e){var n=new t,r=e.data,i=e.url,a=e.method;i=i.indexOf("?")>-1?i+"&v="+l:i+"?v="+l,r&&"string"!=typeof r&&(r=y.stringify(r)),"POST"!=a&&r&&(i=i+(i.indexOf("?")>-1?"&":"?")+r,r=null),n.onreadystatechange=function(){if(n.readyState==("number"==typeof t.DONE?t.DONE:4)){if(200==n.status){var r=n.response||n.responseText||{};e.success&&e.success("string"==typeof r?y.parse(r):r)}else e.error&&e.error(n,n.statusText);e.complete&&e.complete(n)}},n.open(a,i,!0),n.ontimeout=function(){e.error&&e.error(n,n.statusText)},n.timeout=e.timeout||0,n.setRequestHeader&&n.setRequestHeader("Content-Type","application/json;charset=utf-8"),n.withCredentials=(e.xhrFields||{}).withCredentials,n.send(r)}function o(){var e=n.createElement("canvas");if(e&&"function"==typeof e.getContext)for(var t=["webgl","webgl2","experimental-webgl2","experimental-webgl"],r=0;r<t.length;r++){var i=t[r],a=e.getContext(i);if(a){var o={};o.context=i,o.version=a.getParameter(a.VERSION),o.vendor=a.getParameter(a.VENDOR),o.sl_version=a.getParameter(a.SHADING_LANGUAGE_VERSION),o.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);var c=a.getExtension("WEBGL_debug_renderer_info");return c&&(o.vendor=a.getParameter(c.UNMASKED_VENDOR_WEBGL),o.renderer=a.getParameter(c.UNMASKED_RENDERER_WEBGL)),o}}return{}}function c(t,l){function u(e,t){var r,i,a="android"==R.platform&&"qq"==R.brower;a=!1,a?(r="hidden",i="qbrowserVisibilityChange"):"undefined"!=typeof n.hidden?(r="hidden",i="visibilitychange"):"undefined"!=typeof n.msHidden?(r="msHidden",i="msvisibilitychange"):"undefined"!=typeof n.webkitHidden&&(r="webkitHidden",i="webkitvisibilitychange");var o=function(e){return a&&e&&"undefined"!=typeof e.hidden?e.hidden:n[r]},c=setTimeout(function(){null==c||o()||(e(),c=null)},t);i&&n.addEventListener(i,function(e){null!=c&&o(e)&&(clearTimeout(c),c=null)},!1)}function y(e,n,t,r){"function"==typeof t&&u(t,r),j[e](n)}function m(e){var t=n.createElement("div");return t.innerHTML=e,t=t.children[0],t.onclick=function(){n.body.removeChild(t)},t}function g(t,r,i){var a="ex",o="ecC",c="ommand",l="co",u="py",d=a+o+c,s=l+u;if("function"!=typeof n[d])return!1;var p=n.createElement("div");p.innerHTML=t;for(var v=[],y=0;y<p.children.length;y++)v[y]=p.children[y];for(var m,g,b=!1,C=r?r+((new Date).getTime()+1e3*(i||1))+"-":null,y=0;y<v.length;y++)try{if(m=v[y],n.body.appendChild(m),"SELECT"===m.nodeName)m.focus();else if("INPUT"===m.nodeName||"TEXTAREA"===m.nodeName){C&&(m.value=f(h(m.value)+C));var E=m.hasAttribute("readonly");E||m.setAttribute("readonly",""),m.select(),m.setSelectionRange(0,m.value.length),E||m.removeAttribute("readonly")}else{m.hasAttribute("contenteditable")&&m.focus(),C&&m.setAttribute("class",C),g=e.getSelection();var w=n.createRange();w.selectNode(m),g.removeAllRanges(),g.addRange(w)}b=n[d](s),n.body.removeChild(m)}catch(R){n.body.removeChild(m),b=!1}return g&&g.removeAllRanges(),b}function b(){return R.apkUrl&&"function"==typeof t.apkDownloadHandler?void t.apkDownloadHandler(R.apkUrl):void(R.fallbackUrl?(x&&u(function(){n.body.appendChild(x)},400),j[R.fallbackMethod](R.fallbackUrl)):x&&n.body.appendChild(x))}function C(e,n,t){p(function(){D.run(function(){var r=n?b:null;if(e||"android"!=R.platform||"qq"!=R.brower&&"chrome25"!=R.brower&&"samsung"!=R.brower||(e=!0),R.pb&&n&&g(s(R.pb),s(R.ypp),parseInt(s(R.yps)||"0")),R.schemaUrl&&e){var i=(t||{}).timeout||R.wt;y(R.schemaMethod,R.schemaUrl,r,i)}else r&&r()})})}function E(e,n){_&&(clearTimeout(_),_=null);var t=c.server+"/bind/"+I+"?"+i(e);a({url:t,method:"POST",xhrFields:{withCredentials:!0},data:n,success:function(t){R=w(t||{}),t.shadow&&(x=m(t.shadow)),D.ready(),R.ttl&&(_=setTimeout(function(){E(e,n)},1e3*R.ttl))}})}function w(e){var n={sm:"schemaMethod",st:"schemaTimeout",fm:"fallbackMethod",au:"apkUrl",acl:"allowClickLog",p:"pb"};for(var t in e){var r=n[t];r&&(e[r]=e[t],delete e[t])}return e}t=t||{};var R,x,A,O,S,k,T=t.channelCode,I=t.appKey,N=t.onready,D=new r,U=this;if(!I)return void alert("未指定appKey");if(!T){var L=/[\?\&]channelCode=([^=&]+)/.exec(e.location.href);L&&(T=L[1])}"function"==typeof N&&D.run(function(){N.call(U)});try{A=e.screen.width||"",O=e.screen.height||"",k=e.devicePixelRatio||"",S=o()}catch(P){}var _,j={frm:function(e){var t=n.createElement("iframe");t.style.display="none",t.style.visibility="hidden",t.src=e,n.body.appendChild(t)},loc:function(n){e.location=n},hrf:function(e){var t=n.createElement("a");t.style.display="none",t.href=e,n.body.appendChild(t),t.click()},inhrf:function(e){var t=n.createElement("script");t.setAttribute("type","text/javascript"),t.innerHTML='(function(){var a = document.createElement("a");a.style.display = "none";a.href = "'+e.replace(/"/g,'\\"')+'";document.body.appendChild(a);a.click();})()',n.body.appendChild(t)},open:function(n){e.open(n)}};this.wakeupOrInstall=function(e){C(!0,!0,e)},this.schemeWakeup=function(e){C(!0,!1,e)},this.install=function(e){C(!1,!0,e)},t.buttonId&&p(function(){for(var e=t.buttonId.split(" "),r=0;r<e.length;r++){var i=n.getElementById(e[r]);i&&i.addEventListener("click",function(){U.wakeupOrInstall()})}}),v(function(e){for(var n=0,e=e||[],r=e.length;r>n;n++)e[n]=d(e[n]||"");var i={channelCode:T,sw:d(""+(A||0)),sh:d(""+(O||0)),sp:k,gv:d(S.version||""),gr:d(S.renderer||""),li:e,c:t._channelRedirect?1:0,apk:t.apkFileName,pw:t.preferWakeup?1:0};E(i,l)})}var l=2,u=function(){function e(e){var n,t,r,a,o=-1,c=e.length,l=[0,0,0,0];for(n=[];++o<c;)t=e[o],r=e[++o],l[0]=t>>2,l[1]=(3&t)<<4|(r||0)>>4,o>=c?l[2]=l[3]=64:(a=e[++o],l[2]=(15&r)<<2|(a||0)>>6,l[3]=o>=c?64:63&a),n.push(i.charAt(l[0]),i.charAt(l[1]),i.charAt(l[2]),i.charAt(l[3]));return n.join("")}function n(e){for(var n,t,r,a,o,c,l,u=[],d=0;d<e.length;)a=i.indexOf(e.charAt(d++)),o=i.indexOf(e.charAt(d++)),c=i.indexOf(e.charAt(d++)),l=i.indexOf(e.charAt(d++)),n=a<<2|o>>4,t=(15&o)<<4|c>>2,r=(3&c)<<6|l,u.push(n),64!=c&&u.push(t),64!=l&&u.push(r);return u}function t(e){var n,t=-1,r=e.length,i=[];if(/^[\x00-\x7f]*$/.test(e))for(;++t<r;)i.push(e.charCodeAt(t));else for(;++t<r;)n=e.charCodeAt(t),128>n?i.push(n):2048>n?i.push(n>>6|192,63&n|128):i.push(n>>12|224,n>>6&63|128,63&n|128);return i}function r(e){var n,t,r,i=[],a=0;for(n=t=r=0;a<e.length;)n=e[a],128>n?(i.push(String.fromCharCode(n)),a++):n>191&&224>n?(t=e[a+1],i.push(String.fromCharCode((31&n)<<6|63&t)),a+=2):(t=e[a+1],r=e[a+2],i.push(String.fromCharCode((15&n)<<12|(63&t)<<6|63&r)),a+=3);return i.join("")}var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";return[function(n){if(!n)return"";for(var r=t(n),i=r.length,a=0;i>a;a++)r[a]=150^r[a];return e(r)},function(e){if(!e)return"";for(var t=n(e),i=0,a=t.length;a>i;i++)t[i]=150^t[i];return r(t)},function(n){return n?e(t(n)):""},function(e){return e?r(n(e)):""}]}(),d=u[0],s=u[1],f=u[2],h=u[3],p=function(){"use strict";function t(){if(!a){a=!0;for(var n=0;n<i.length;n++)i[n].fn.call(e,i[n].ctx);i=[]}}function r(){"complete"===n.readyState&&t()}var i=[],a=!1,o=!1;return function(c,l){return a?void c(l):(i.push({fn:c,ctx:l}),void("complete"===n.readyState||!n.attachEvent&&"interactive"===n.readyState?t():o||(n.addEventListener?(n.addEventListener("DOMContentLoaded",t,!1),e.addEventListener("load",t,!1)):(n.attachEvent("onreadystatechange",r),e.attachEvent("onload",t)),o=!0)))}}(),v=function(){function n(){s.isReady()||(s.ready(),clearInterval(f),c&&c.close())}function t(){n()}function i(e){for(var n=e.split("."),t=0,r=0;r<n.length;r++)t=t<<8|255&parseInt(n[r]);return t}function a(e){for(var t,r,a,o,c=e.split("\r\n"),l=0;l<c.length;l++){if(t=c[l],r=t.split(" "),0==t.indexOf("a=candidate:")&&(a=r[7])&&"host"==a&&(o=r[4]));else if(0==t.indexOf("a=rtcp:")&&(a=r[2])&&"IP4"==a&&(o=r[3]));else if(0!=t.indexOf("c=")||!(a=r[1])||"IP4"!=a||!(o=r[2]))continue;o&&!u[o]&&/[0-9]{1,3}(\.[0-9]{1,3}){3}/.test(o)&&("0.0.0.0"==o||0==o.indexOf("127.")||3758096384==(4026531840&i(o))||(u[o]=1,d.push(o)))}d.length&&n()}var o,c,l,u={},d=[],s=new r,f=setInterval(function(){c&&c.localDescription&&c.localDescription.sdp&&l!=c.localDescription.sdp&&(l=c.localDescription.sdp,a(l))},10);try{(o=e.RTCPeerConnection||e.mozRTCPeerConnection||e.webkitRTCPeerConnection)?(c=new o({iceServers:[]},{optional:[{RtpDataChannels:!0}]}),c.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&a("a="+e.candidate.candidate)},c.createDataChannel("openinstall"),c.createOffer(function(e){try{c.setLocalDescription(e,function(){},t)}catch(n){t(n)}},t),setTimeout(n,2e3)):t("not exists")}catch(h){t(h)}return function(e){s.run(function(){e(d)})}}(),y=e.JSON||{parse:function(e){return eval("("+e+")")},stringify:function(){var e=Object.prototype.toString,n=Array.isArray||function(n){return"[object Array]"===e.call(n)},t={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},r=function(e){return t[e]||"\\u"+(e.charCodeAt(0)+65536).toString(16).substr(1)},i=/[\\"\u0000-\u001F\u2028\u2029]/g;return function a(t){if(null==t)return"null";if("number"==typeof t)return isFinite(t)?t.toString():"null";if("boolean"==typeof t)return t.toString();if("object"==typeof t){if("function"==typeof t.toJSON)return a(t.toJSON());if(n(t)){for(var o="[",c=0;c<t.length;c++)o+=(c?", ":"")+a(t[c]);return o+"]"}if("[object Object]"===e.call(t)){var l=[];for(var u in t)t.hasOwnProperty(u)&&l.push(a(u)+": "+a(t[u]));return"{"+l.sort().join(", ")+"}"}}return'"'+t.toString().replace(i,r)+'"'}}()};return c.channelRedirect=function(e,n){new c({appKey:e,channelCode:n,_channelRedirect:!0}).wakeupOrInstall()},c.parseUrlParams=function(){for(var n=(e.location.search||"?").substring(1).replace(/\+/g,"%20"),t=n.split("&"),r={},i=0;i<t.length;i++){var a=t[i].split("="),o=decodeURIComponent(a[0]||""),c=decodeURIComponent(a[1]||"");o&&c&&("undefined"==typeof r[o]?r[o]=c:"object"==typeof r[o]?r[o].push(c):r[o]=[r[o],c])}return r},c.docReady=p,c.server="//openinstall.io",c}(window,document,XMLHttpRequest);
